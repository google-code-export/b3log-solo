/*
 * Copyright (c) 2009, 2010, 2011, B3log Team
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Util={error:function(){alert("Error: "+arguments[0]+"\nFile: "+arguments[1]+"\nLine: "+arguments[2]+"\nplease report this issue on http://code.google.com/p/b3log-solo/issues/list")},killIE:function(){if($.browser.msie){if($.browser.version==="6.0"||$.browser.version==="7.0"){window.location="/kill-browser.html";return}if(window.external&&window.external.twGetRunPath){var a=external.twGetRunPath();if(a&&a.toLowerCase().indexOf("360se")>-1&&window.location.href.indexOf("admin-index")>-1){window.location="/kill-browser.html";return}}}},getCursorEndPosition:function(a){a.focus();if(a.setSelectionRange){return a.selectionEnd}else if(document.selection){var i=0,oS=document.selection.createRange(),oR=document.body.createTextRange();oR.moveToElementText(a);oS.getBookmark();for(i=0;oR.compareEndPoints('StartToStart',oS)<0&&oS.moveStart("character",-1)!==0;i++){if(a.value.charAt(i)=='\n'){i++}}return i}},_processEm:function(a){if(a.replace(/\s/g,"")===""){return""}var b=[],resultStr="",brList=["<br>","<br/>","<BR>","<BR/>"];for(var j=0;j<brList.length;j++){if(a.indexOf(brList[j])>-1){b=a.split(brList[j])}}if(b.length===0){return"<span class='em-span'>"+a+"</span>"}for(var i=0;i<b.length;i++){resultStr+="<span class='em-span'>"+b[i]+"</span>";if(i!==b.length-1){resultStr+="<br class='em-br'>"}}return resultStr},replaceEmString:function(a){var b=a.split("[em");if(b.length===1){return a}a=this._processEm(b[0]);if($.trim(b[0])===""){a=""}for(var j=1;j<b.length;j++){var c=b[j].substr(0,2);a+="<span class='em"+c+"'></span>"+this._processEm(b[j].slice(3))}return a+"<div class='clear'></div>"}};var Common=function(a){this.tips=a};$.extend(Common.prototype,{goTop:function(){window.scrollTo(0,0)},goBottom:function(){switch(this.tips.skinDirName){case"tree-house":window.scrollTo(0,$("body").height()-$(window).height()-700);break;default:window.scrollTo(0,$("body").height()-$(window).height());break}},init:function(){Util.killIE();var e=this.tips;$.ajax({type:"POST",url:"/check-login.do",success:function(a){if(a.isLoggedIn){var b="<span>"+a.userName+"</span>";if(a.isAdmin){b+="<a href=\"javascript:common.clearCache('all');\">"+e.clearAllCacheLabel+"</a>"+"<a href='javascript:common.clearCache();'>"+e.clearCacheLabel+"</a>"}b+="<a href='/admin-index.do#main' title='"+e.adminLabel+"'>"+e.adminLabel+"</a>"+"<a href='"+a.logoutURL+"' title='"+e.logoutLabel+"'>"+e.logoutLabel+"</a>";$("#admin").append(b)}else{$("#admin").append("<a href='"+a.loginURL+"' title='"+e.loginLabel+"'>"+e.loginLabel+"</a>")}},error:function(a,b,c,d){console.error(a);}})},clearCache:function(b){var c={};if(b==="all"){c={"all":"all","URI":""}}else{c={"all":"","URI":window.location.pathname}}$.ajax({type:"POST",url:"/clear-cache.do",contentType:"application/json",data:JSON.stringify(c),success:function(a){window.location.reload()}})},replaceSideEm:function(a){for(var i=0;i<a.length;i++){var b=$(a[i]);var c=b.html().split("[em");var d=c[0];for(var j=1;j<c.length;j++){var e=c[j].substr(0,2);d+="["+this.tips["em"+e+"Label"]+"]"+c[j].slice(3)}b.html(d)}},buildTags:function(e){e=e||"tags";$("#"+e).html($("#"+e+" li").get().sort(function(a,b){var c=$(a).find("span").text().toLowerCase();var d=$(b).find("span").text().toLowerCase();return(c<d)?-1:(c>d)?1:0}));var f=$("#"+e+" a").get();f.sort(function(a,b){var c=parseInt($(a).data("count"));var d=parseInt($(b).data("count"));return(c<d)?-1:(c>d)?1:0});var g=f.length,classes=["tags1","tags2","tags3","tags4","tags5"];var h=Math.round(g/classes.length);for(var i=0,c=0;i<g;i++){if(c<classes.length-1){for(var j=0;j<h;j++){f[i++].className=classes[c]}c++;i--}else{f[i].className=classes[c]}}}});var goTop=function(a){a=a||0.1;var y=$(window).scrollTop();var b=1+a;window.scrollTo(0,Math.floor(y/b));if(y>0){var c="goTop("+a+")";window.setTimeout(c,16)}};var collapseArchive=function(b,c){var d=true;if(b.className==="collapse-ico"){b.className="expand-ico";d=false}else{b.className="collapse-ico"}$("#archiveSide li").each(function(){var a=$(this);if(a.data("year")===c){if(d){$(this).show()}else{$(this).hide()}}})};var getArticle=function(c,d){var e=$("#abstract"+d),$content=$("#content"+d);if($content.html()===""){$.ajax({url:"/get-article-content?id="+d,type:"GET",dataType:"html",beforeSend:function(){e.css("background","url(/skins/neoease/images/ajax-loader.gif) no-repeat scroll center center transparent")},success:function(a,b){c.className="collapse-ico";$content.html(a);e.hide().css("background","none");$content.fadeIn("slow")}})}else{if(c.className==="expand-ico"){e.hide();$content.fadeIn();c.className="collapse-ico"}else{$content.hide();e.fadeIn();c.className="expand-ico"}}return false};var goTranslate=function(){window.open("http://translate.google.com/translate?sl=auto&tl=auto&u="+location.href)};(function(){$(window).scroll(function(){var y=$(window).scrollTop();if(y>182){var a=y+window.innerHeight-21;if($("body").height()-58<=y+window.innerHeight){a=$(".footer").offset().top-21}$("#goTop").fadeIn("slow").css("top",a)}else{$("#goTop").hide()}});var b=(new Date()).getFullYear(),year=b;$("#archiveSide li").each(function(i){var a=$(this);if(a.data("year")!==b){$(this).hide()}if(year!==a.data("year")){year=a.data("year");a.before("<li class='archive-year'><div onclick='collapseArchive(this, "+year+")' class='expand-ico'>"+year+"&nbsp;å¹´</div></li>")}});$(".recent-comments .expand-ico").click(function(){if(this.className==="expand-ico"){$(this).parent().next().css("height","auto");this.className="collapse-ico"}else{$(this).parent().next().animate({"height":"16px"});this.className="expand-ico"}});$(".nav ul a").each(function(){var a=$(this);if(a.attr("href")===location.pathname){a.parent().addClass("current")}else if(/\/[0-9]+$/.test(location.pathname)){$(".nav ul li")[0].className="current"}})})();