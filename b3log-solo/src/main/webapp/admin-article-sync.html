<table class="form" width="99%" cellpadding="0" cellspacing="9px">
    <tbody>
        <tr>
            <th width="124px">
                {userNameLabel}
            </th>
            <td width="360px">
                <input id="userName"/>
            </td>
            <td>
                <button onclick="getCSDNBlogArticleArchiveDate();">{submit}</button>
                <select id="archiveDate" class="none" onchange="getCSDNBlogArticlesByArchiveDate();">
                    <option>{选择月份}</option>
                </select>
            </td>
        </tr>
    </tbody>
</table>
<div id="loading"></div>
<div id="articlesPanel" class="none">
    <button onclick="sync();">{submit}</button>
    <div id="articleList" class="maginTB12"></div>
    <button onclick="sync();">{submit}</button>
</div>
<script type="text/javascript">
    var userName = "";
    $("#articleList").table({
        resizable: true,
        height: 400,
        colModel: [{
                name: "选择",
                index: "selected",
                width: 46,
                inputType: "checkbox",
                textAlign: "center",
                allSelected: true
            }, {
                name: "${titleLabel}",
                index: "title",
                minWidth: 180,
                style: "padding-left: 6px;"
            },  {
                name: "{tags}",
                index: "tags",
                width: 160
            }, {
                textAlign: "center",
                name: "${createDateLabel}",
                index: "date",
                width: 100
            }, {
                visible: false,
                index: "id"
            }]
    });

    $("#userName").keypress(function (event) {
        if (event.keyCode === 13) {
            getCSDNBlogArticleArchiveDate();
        }
    })

    var getCSDNBlogArticleArchiveDate = function () {
        userName = $("#userName").val();
        jsonRpc.blogSyncService.getCSDNBlogArticleArchiveDate(function (result, error) {
            $("#archiveDate").html("<option>{选择月份}</option>").show(500);
            for (var i = 0; i < result.blogSyncCSDNBlogArchiveDates.length; i++) {
                $("#archiveDate").append("<option>" + result.blogSyncCSDNBlogArchiveDates[i] + "</option>");
            }

        }, {"blogSyncCSDNBlogUserName": userName});
    }

    var getCSDNBlogArticlesByArchiveDate = function () {
        $("#loading").loading({
            imgURL: "images/ajax-loader.gif"
        });
        $("#articlesPanel").hide(800);

        var requestJSONObject = {
            "blogSyncCSDNBlogUserName": userName,
            "blogSyncCSDNBlogArchiveDate": $("#archiveDate").val()
        };
        
        jsonRpc.blogSyncService.getCSDNBlogArticlesByArchiveDate(function (result, error) {
            $("#articlesPanel").show();

            var articles = result.blogSyncCSDNBlogArticles;
            if (articles.length > 0) {
                var articleData = [];

                for (var i = 0; i < articles.length; i++) {
                    articleData[i] = {};
                    articleData[i].selected = false;
                    articleData[i].title = articles[i].blogSyncCSDNBlogArticleTitle;
                    articleData[i].date = $.bowknot.getDate(articles[i].blogSyncCSDNBlogArticleCreateDate.time);
                    articleData[i].tags = articles[i].blogSyncCSDNBlogArticleCategories;
                    articleData[i].id = articles[i].blogSyncCSDNBlogArticleId;
                }

                $("#articleList").table({
                    update:{
                        data: articleData
                    }
                });
            } else {
                $("#tipMsg").text("加载失败！");
            }
            $("#loading").loading("close");
        }, requestJSONObject);
    }
    
    var sync = function () {
        var requestJSONObject = {
            "blogSyncCSDNBlogUserName":  userName,
            "blogSyncCSDNBlogArticleIds": $("#articleList_selected").data("id")
        };

        jsonRpc.blogSyncService.importCSDNBlogArticles(function (result, error) {
            $("#tipMsg").text(result.oIds + "导出成功！");
        }, requestJSONObject);
    }
</script>