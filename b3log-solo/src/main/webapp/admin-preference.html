<div>
    <div class="tabs">
        <ul>
            <li>
                <span class="selected" id="preferences" onclick="changeTab(this);">
                    ${paramSettingsLabel}
                </span>
            </li>
            <li>
                <span id="skins" onclick="changeTab(this);">
                    ${skinLabel]
                </span>
            </li>
        </ul>
        <div class="clear"></div>
    </div>
    <div class="tabPanels">
        <div id="preferencesPanel">
            <table class="form" width="99%" cellpadding="0" cellspacing="9px">
                <tbody>
                    <tr>
                        <th width="124px">
                            首页 Tag 显示数：
                        </th>
                        <td>
                            <input id="mostUsedTagDisplayCount"/>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            最新文章显示数目:
                        </th>
                        <td>
                            <input id="recentArticleDisplayCount"/>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            评论最多文章数目:
                        </th>
                        <td>
                            <input id="mostCommentArticleDisplayCount"/>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            文章列表显示数:
                        </th>
                        <td>
                            <input id="articleListDisplayCount"/>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            分页大小:
                        </th>
                        <td>
                            <input id="articleListPaginationWindowSize"/>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            博客标题:
                        </th>
                        <td>
                            <input id="blogTitle"/>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            博客子标题:
                        </th>
                        <td>
                            <input id="blogSubtitle"/>
                        </td>
                    </tr>
                    <tr>
                        <th colspan="2">
                            <button onclick="changePreference();">submit</button>
                        </th>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="skinsPanel" class="none">
            <button onclick="changePreference();">submit</button>
        </div>
    </div>
</div>

<div class="clear"></div>
<script type="text/javascript">
    var changeTab = function (it) {
        var tabs = ['preferences', 'skins'];
        for (var i = 0; i < tabs.length; i++) {
            if (it.id === tabs[i]) {
                $("#" + tabs[i] + "Panel").show();
                $("#" + tabs[i]).addClass("selected");
            } else {
                $("#" + tabs[i] + "Panel").hide();
                $("#" + tabs[i]).removeClass("selected");
            }
        }
    }
    
    var changePreference = function () {
        var requestJSONObject = {
            "preference": {
                "blogTitle": $("#blogTitle").val(),
                "blogSubtitle": $("#blogSubtitle").val(),
                "mostCommentArticleDisplayCount": $("#mostCommentArticleDisplayCount").val(),
                "recentArticleDisplayCount": $("#recentArticleDisplayCount").val(),
                "mostUsedTagDisplayCount": $("#mostUsedTagDisplayCount").val(),
                "articleListDisplayCount": $("#articleListDisplayCount").val(),
                "articleListPaginationWindowSize": $("#articleListPaginationWindowSize").val(),
                "skinDirName": "classic" // TODO: preference skin select
            }
        }

        jsonRpc.preferenceService.updatePreference(function (result, error) {
            switch (result.sc) {
                case "UPDATE_PREFERENCE_SUCC":
                    $("#tipMsg").text("update preference sucess!");
                    break;
                case "GET_ARTICLE_FAIL_":
                    break;
                default:
                    break;
            }
        }, requestJSONObject);
    }

    var getPreference = function () {
        jsonRpc.preferenceService.getPreference(function (result, error) {
            switch (result.sc) {
                case "GET_PREFERENCE_SUCC":
                    var preference = result.preference;
                    // preference
                    $("#blogTitle").val(preference.blogTitle),
                    $("#blogSubtitle").val(preference.blogSubtitle),
                    $("#mostCommentArticleDisplayCount").val(preference.mostCommentArticleDisplayCount);
                    $("#recentArticleDisplayCount").val(preference.recentArticleDisplayCount);
                    $("#mostUsedTagDisplayCount").val(preference.mostUsedTagDisplayCount);
                    $("#articleListDisplayCount").val(preference.articleListDisplayCount);
                    $("#articleListPaginationWindowSize").val(preference.articleListPaginationWindowSize);

                    // skin
                    var skins = eval('(' + preference.skins + ')');
                    var skinsHTML = "";
                    for (var i = 0; i < skins.length; i++) {
                        skinsHTML += "<div><img class='skinPreview' src='skins/"
                            + skins[i].skinDirName + "/preview.png'/><span>" + skins[i].skinName + "</span></div>"
                    }
                    $("#skinsPanel").append(skinsHTML);
                    break;
                default:
                    break;
            }
        });
    }

    getPreference();
</script>