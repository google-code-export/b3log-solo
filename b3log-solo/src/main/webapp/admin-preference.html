<div>
    <div class="tabs">
        <ul>
            <li>
                <span class="selected" id="preferences" onclick="changeTab(this);">
                    ${paramSettingsLabel}
                </span>
            </li>
            <li>
                <span id="skins" onclick="changeTab(this);">
                    ${skinLabel}
                </span>
            </li>
        </ul>
        <div class="clear"></div>
    </div>
    <div class="tabPanels">
        <div id="preferencesPanel">
            <table class="form" width="99%" cellpadding="0" cellspacing="9px">
                <tbody>
                    <tr>
                        <th width="124px">
                            ${indexTagDisplayCnt1Label}
                        </th>
                        <td>
                            <input id="mostUsedTagDisplayCount"/>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            ${indexRecentArticleDisplayCnt1Label}
                        </th>
                        <td>
                            <input id="recentArticleDisplayCount"/>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            ${indexMostCommentArticleDisplayCnt1Label}
                        </th>
                        <td>
                            <input id="mostCommentArticleDisplayCount"/>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            ${pageSize1Label}
                        </th>
                        <td>
                            <input id="articleListDisplayCount"/>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            ${windowSize1Label}
                        </th>
                        <td>
                            <input id="articleListPaginationWindowSize"/>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            ${blogTitle1Label}
                        </th>
                        <td>
                            <input id="blogTitle"/>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            ${blogSubtitle1Label}
                        </th>
                        <td>
                            <input id="blogSubtitle"/>
                        </td>
                    </tr>
                    <tr>
                        <th colspan="2">
                            <button onclick="changePreference();">${saveLabel}</button>
                        </th>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="skinsPanel" class="none">
            <div id="skinMain">
            </div>
            <button onclick="changePreference();">${saveLabel}</button>
        </div>
    </div>
</div>

<div class="clear"></div>
<script type="text/javascript">
    var changeTab = function (it) {
        var tabs = ['preferences', 'skins'];
        for (var i = 0; i < tabs.length; i++) {
            if (it.id === tabs[i]) {
                $("#" + tabs[i] + "Panel").show();
                $("#" + tabs[i]).addClass("selected");
            } else {
                $("#" + tabs[i] + "Panel").hide();
                $("#" + tabs[i]).removeClass("selected");
            }
        }
    }
    
    var changePreference = function () {
        alert($("#shinMain").data("shinDirName"));
        var requestJSONObject = {
            "preference": {
                "blogTitle": $("#blogTitle").val(),
                "blogSubtitle": $("#blogSubtitle").val(),
                "mostCommentArticleDisplayCount": $("#mostCommentArticleDisplayCount").val(),
                "recentArticleDisplayCount": $("#recentArticleDisplayCount").val(),
                "mostUsedTagDisplayCount": $("#mostUsedTagDisplayCount").val(),
                "articleListDisplayCount": $("#articleListDisplayCount").val(),
                "articleListPaginationWindowSize": $("#articleListPaginationWindowSize").val(),
                "skinDirName": $("#shinMain").data("shinDirName")
            }
        }

        jsonRpc.preferenceService.updatePreference(function (result, error) {
            switch (result.sc) {
                case "UPDATE_PREFERENCE_SUCC":
                    $("#tipMsg").text("${updateSuccLabel}");
                    break;
                case "GET_ARTICLE_FAIL_":
                    break;
                default:
                    break;
            }
        }, requestJSONObject);
    }

    var getPreference = function () {
        jsonRpc.preferenceService.getPreference(function (result, error) {
            switch (result.sc) {
                case "GET_PREFERENCE_SUCC":
                    var preference = result.preference;
                    // preference
                    $("#blogTitle").val(preference.blogTitle),
                    $("#blogSubtitle").val(preference.blogSubtitle),
                    $("#mostCommentArticleDisplayCount").val(preference.mostCommentArticleDisplayCount);
                    $("#recentArticleDisplayCount").val(preference.recentArticleDisplayCount);
                    $("#mostUsedTagDisplayCount").val(preference.mostUsedTagDisplayCount);
                    $("#articleListDisplayCount").val(preference.articleListDisplayCount);
                    $("#articleListPaginationWindowSize").val(preference.articleListPaginationWindowSize);

                    // skin
                    $("#skinMain").data("shinDirName", preference.skinDirName);
                    var skins = eval('(' + preference.skins + ')');
                    var skinsHTML = "";
                    for (var i = 0; i < skins.length; i++) {
                        if (skins[i].skinName === preference.skinName
                            && skins[i].skinDirName === preference.skinDirName ) {
                            skinsHTML += "<div title='" + skins[i].skinDirName
                                + "' class='left skinItem selected'><img class='skinPreview' src='skins/"
                                + skins[i].skinDirName + "/preview.png'/><span>" + skins[i].skinName + "</span></div>"
                        } else {
                            skinsHTML += "<div class='left skinItem'><img class='skinPreview' src='skins/"
                                + skins[i].skinDirName + "/preview.png'/><span>" + skins[i].skinName + "</span></div>"
                        }
                    }
                    $("#skinMain").append(skinsHTML + "<div class='clear'></div>");
                    
                    $(".skinItem").click(function () {
                        $(".skinItem").removeClass("selected");
                        $(this).addClass("selected");
                        $("#skinMain").data("shinDirName", this.title);
                    });
                    break;
                default:
                    break;
            }
        });
    }

    getPreference();
</script>
