/*
 * Copyright (c) 2009, 2010, 2011, B3log Team
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Util={error:function(){alert("Error: "+arguments[0]+"\nFile: "+arguments[1]+"\nLine: "+arguments[2]+"\nplease report this issue on http://code.google.com/p/b3log-solo/issues/list")},killIE:function(){if($.browser.msie){if($.browser.version==="6.0"||$.browser.version==="7.0"){window.location="/kill-browser.html";return}if(window.external&&window.external.twGetRunPath){var a=external.twGetRunPath();if(a&&a.toLowerCase().indexOf("360se")>-1&&window.location.href.indexOf("admin-index")>-1){window.location="/kill-browser.html";return}}}},getCursorEndPosition:function(a){a.focus();if(a.setSelectionRange){return a.selectionEnd}else{if(document.selection){var b=0,c=document.selection.createRange(),d=document.body.createTextRange();d.moveToElementText(a);c.getBookmark();for(b=0;d.compareEndPoints("StartToStart",c)<0&&c.moveStart("character",-1)!==0;b++){if(a.value.charAt(b)=="\n"){b++}}return b}}},_processEm:function(f){if(f.replace(/\s/g,"")===""){return""}var e=[],c="",d=["<br>","<br/>","<BR>","<BR/>"];for(var a=0;a<d.length;a++){if(f.indexOf(d[a])>-1){e=f.split(d[a])}}if(e.length===0){return"<span class='em-span'>"+f+"</span>"}for(var b=0;b<e.length;b++){c+="<span class='em-span'>"+e[b]+"</span>";if(b!==e.length-1){c+="<br class='em-br'>"}}return c},replaceEmString:function(d){var c=d.split("[em");if(c.length===1){return d}d=this._processEm(c[0]);if($.trim(c[0])===""){d=""}for(var a=1;a<c.length;a++){var b=c[a].substr(0,2);d+="<span class='em"+b+"'></span>"+this._processEm(c[a].slice(3))}return d+"<div class='clear'></div>"},proessURL:function(a){if(!/^\w+:\/\//.test(a)){a="http://"+a}return a}};var Common=function(a){this.tips=a};$.extend(Common.prototype,{goTop:function(){window.scrollTo(0,0)},goBottom:function(a){if(!a){a=0}window.scrollTo(0,$("body").height()-$(window).height()-a)},init:function(){Util.killIE()},clearCache:function(a){var b={};if(a==="all"){b={all:"all",URI:""}}else{b={all:"",URI:window.location.pathname}}$.ajax({type:"POST",url:"/clear-cache.do",contentType:"application/json",data:JSON.stringify(b),success:function(c){window.location.reload()}})},replaceSideEm:function(g){for(var c=0;c<g.length;c++){var d=$(g[c]);var f=d.html().split("[em");var e=f[0];for(var a=1;a<f.length;a++){var b=f[a].substr(0,2);e+="["+this.tips["em"+b+"Label"]+"]"+f[a].slice(3)}d.html(e)}},buildTags:function(h){h=h||"tags";var e=["tags1","tags2","tags3","tags4","tags5"],f=$("#"+h+" b").get();var a=parseInt($("#"+h+" b").last().text());var g=Math.ceil(a/e.length);for(var d=0;d<f.length;d++){var c=parseInt(f[d].innerHTML);for(var b=0;b<e.length;b++){if(c>b*g&&c<=(b+1)*g){f[d].parentNode.className=e[b];break}}}$("#"+h).html($("#"+h+" li").get().sort(function(k,i){var l=$(k).find("span").text().toLowerCase();var j=$(i).find("span").text().toLowerCase();return l.localeCompare(j)}))}});var goTop=function(b){b=b||0.1;var d=$(window).scrollTop();var c=1+b;window.scrollTo(0,Math.floor(d/c));if(d>0){var a="goTop("+b+")";window.setTimeout(a,16)}};var collapseArchive=function(c,b){var a=true;if(c.className==="collapse-ico"){c.className="expand-ico";a=false}else{c.className="collapse-ico"}$("#archiveSide li").each(function(){var d=$(this);if(d.data("year")===b){if(a){$(this).show()}else{$(this).hide()}}})};var getArticle=function(b,d){var c=$("#abstract"+d),a=$("#content"+d);if(a.html()===""){$.ajax({url:"/get-article-content?id="+d,type:"GET",dataType:"html",beforeSend:function(){c.css("background","url(/skins/neoease/images/ajax-loader.gif) no-repeat scroll center center transparent")},success:function(e,f){b.className="collapse-ico";a.html(e);c.hide().css("background","none");a.fadeIn("slow")}})}else{if(b.className==="expand-ico"){c.hide();a.fadeIn();b.className="collapse-ico"}else{a.hide();c.fadeIn();b.className="expand-ico"}}return false};var goTranslate=function(){window.open("http://translate.google.com/translate?sl=auto&tl=auto&u="+location.href)};(function(){$(window).scroll(function(){var e=$(window).scrollTop();if(e>182){var c=$(window).height();var d=e+c-21;if($("body").height()-58<=e+c){d=$(".footer").offset().top-21}$("#goTop").fadeIn("slow").css("top",d)}else{$("#goTop").hide()}});var a=(new Date()).getFullYear(),b=a;$("#archiveSide li").each(function(c){var d=$(this);if(d.data("year")!==a){$(this).hide()}if(b!==d.data("year")){b=d.data("year");d.before("<li class='archive-year'><div onclick='collapseArchive(this, "+b+")' class='expand-ico'>"+b+"&nbsp;\u5e74Â´</div></li>")}});$(".recent-comments .expand-ico").click(function(){if(this.className==="expand-ico"){$(this).parent().next().css({height:"auto","white-space":"normal"});this.className="collapse-ico"}else{$(this).parent().next().animate({height:"18px"},function(){$(this).css("white-space","nowrap")});this.className="expand-ico"}});$(".nav ul a").each(function(){var c=$(this);if(c.attr("href")===location.pathname){c.parent().addClass("current")}else{if(/\/[0-9]+$/.test(location.pathname)){$(".nav ul li")[0].className="current"}}})})();