<table class="form" width="99%" cellpadding="0" cellspacing="9px">
    <tbody>
        <tr>
            <th width="124px">
                ${csdnUserName1Label}
            </th>
            <td width="360px">
                <input id="userName"/>
            </td>
            <td>
                <button onclick="getCSDNBlogArticleArchiveDate();">${getDateLabel}</button>
                <select id="archiveDate" class="none" onchange="getCSDNBlogArticlesByArchiveDate();">
                    <option>${selectDateLabel}</option>
                </select>
            </td>
        </tr>
    </tbody>
</table>
<div id="articlesPanel" class="">
    <button onclick="sync();" class="left">${importLabel}</button>
    <div id="articlesCount" class="right error-msg maginTR12">
    </div>
    <div class="clear"></div>
    <div id="articleList" class="maginTB12"></div>
    <button onclick="sync();">${importLabel}</button>
</div>
<div id="loading"></div>
<script type="text/javascript">
    var userName = "";
    $("#articleList").table({
        resizable: true,
        height: 400,
        colModel: [{
                name: "选择",
                index: "selected",
                width: 46,
                inputType: "checkbox",
                textAlign: "center",
                allSelected: true
            }, {
                name: "${titleLabel}",
                index: "title",
                minWidth: 180,
                style: "padding-left: 6px;"
            },  {
                name: "${categoryLabel}",
                index: "tags",
                width: 160
            }, {
                textAlign: "center",
                name: "${createDateLabel}",
                index: "date",
                width: 100
            }, {
                textAlign: "center",
                name: "${importedLabel}",
                index: "imported",
                width: 50
            }, {
                visible: false,
                index: "id"
            }]
    });

    $("#userName").keypress(function (event) {
        if (event.keyCode === 13) {
            getCSDNBlogArticleArchiveDate();
        }
    }).focus(function () {
        $("#archiveDate").hide(500);
    });

    var getCSDNBlogArticleArchiveDate = function () {
        userName = $("#userName").val();
        var result = jsonRpc.blogSyncService.
            getCSDNBlogArticleArchiveDate({"blogSyncCSDNBlogUserName": userName});
        $("#archiveDate").html("<option>${selectDateLabel}</option>").show(500);
        for (var i = 0; i < result.blogSyncCSDNBlogArchiveDates.length; i++) {
            $("#archiveDate").append("<option>" + result.blogSyncCSDNBlogArchiveDates[i] + "</option>");
        }
    }

    var getCSDNBlogArticlesByArchiveDate = function () {
        var articleLength = 0;
        $("#loading").loading({
            imgURL: "images/ajax-loader.gif"
        });
        $("#articlesPanel").hide();

        var requestJSONObject = {
            "blogSyncCSDNBlogUserName": userName,
            "blogSyncCSDNBlogArchiveDate": $("#archiveDate").val()
        };

        while (true) {
            var result =
                jsonRpc.blogSyncService.getCSDNBlogArticlesByArchiveDate(requestJSONObject);

            var articles = result.blogSyncCSDNBlogArticles;
            if (articles.length == articleLength) {
                break;
            }
            articleLength = articles.length;
            if (articles.length > 0) {
                var articleData = [];

                for (var i = 0; i < articles.length; i++) {
                    articleData[i] = {};
                    articleData[i].selected = false;
                    articleData[i].title = articles[i].blogSyncCSDNBlogArticleTitle;
                    articleData[i].date = $.bowknot.getDate(articles[i].blogSyncCSDNBlogArticleCreateDate.time);
                    articleData[i].tags = articles[i].blogSyncCSDNBlogArticleCategories;
                    articleData[i].id = articles[i].oId;
                    articleData[i].imported = articles[i].blogSyncImported;
                }

                $("#articleList").table({
                    update:{
                        data: articleData
                    }
                });

                $("#articlesCount").html("${sumLabel}" + articleData.length + "{count}");
            } else {
                $("#tipMsg").text("${getFailLabel}");
            }
            $("#articlesPanel").show();
        }
        $("#loading").loading("close");
    }
    
    var sync = function () {
        var requestJSONObject = {
            "oIds": $("#articleList_selected").data("id")
        };

        var result = jsonRpc.blogSyncService.importCSDNBlogArticles(requestJSONObject);
        $("#tipMsg").text(result.oIds + "${importSuccLabel}");
    }
</script>