/*
 * Copyright (c) 2009, 2010, 2011, B3log Team
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Util={error:function(){$("#tipMsg").text("Error: "+arguments[0]+" File: "+arguments[1]+"\nLine: "+arguments[2]+" please report this issue on http://code.google.com/p/b3log-solo/issues/list");$("#loadMsg").text("")},killIE:function(){if($.browser.msie){if($.browser.version==="6.0"||$.browser.version==="7.0"){window.location="/kill-browser.html";return}if(window.external&&window.external.twGetRunPath){var a=external.twGetRunPath();if(a&&a.toLowerCase().indexOf("360se")>-1&&window.location.href.indexOf("admin-index")>-1){window.location="/kill-browser.html";return}}}},getCursorEndPosition:function(a){a.focus();if(a.setSelectionRange){return a.selectionEnd}else if(document.selection){var b=0,c=document.selection.createRange(),d=document.body.createTextRange();d.moveToElementText(a);c.getBookmark();for(b=0;d.compareEndPoints("StartToStart",c)<0&&c.moveStart("character",-1)!==0;b++){if(a.value.charAt(b)=="\n"){b++}}return b}},_processEm:function(a){if(a.replace(/\s/g,"")===""){return""}var b=[],c="",d=["<br>","<br/>","<BR>","<BR/>"];for(var e=0;e<d.length;e++){if(a.indexOf(d[e])>-1){b=a.split(d[e])}}if(b.length===0){return"<span class='em-span'>"+a+"</span>"}for(var f=0;f<b.length;f++){c+="<span class='em-span'>"+b[f]+"</span>";if(f!==b.length-1){c+="<br class='em-br'>"}}return c},replaceEmString:function(a){var b=a.split("[em");if(b.length===1){return a}a=this._processEm(b[0]);if($.trim(b[0])===""){a=""}for(var c=1;c<b.length;c++){var d=b[c].substr(0,2);a+="<span class='em"+d+"'></span>"+this._processEm(b[c].slice(3))}return a+"<div class='clear'></div>"},proessURL:function(a){if(!/^\w+:\/\//.test(a)){a="http://"+a}return a},switchMobile:function(a){Cookie.createCookie("btouch_switch_toggle",a,365);setTimeout(function(){location.reload()},1250)},setTopBar:function(){var a=$("#top");if(a.length===1){var b=$("#showTop");b.click(function(){a.slideDown();b.hide()});$("#hideTop").click(function(){a.slideUp();b.show()})}}};var Common=function(a){this.tips=a};$.extend(Common.prototype,{goTop:function(){window.scrollTo(0,0)},goBottom:function(a){if(!a){a=0}window.scrollTo(0,$("body").height()-$(window).height()-a)},init:function(){Util.killIE();Util.setTopBar()},clearCache:function(a){var b={};if(a==="all"){b={all:"all",URI:""}}else{b={all:"",URI:window.location.pathname}}$.ajax({type:"POST",url:"/clear-cache.do",cache:false,contentType:"application/json",data:JSON.stringify(b),success:function(a){window.location.reload()}})},replaceSideEm:function(a){for(var b=0;b<a.length;b++){var c=$(a[b]);var d=c.html().split("[em");var e=d[0];for(var f=1;f<d.length;f++){var g=d[f].substr(0,2);e+="["+this.tips["em"+g+"Label"]+"]"+d[f].slice(3)}c.html(e)}},buildTags:function(a){a=a||"tags";var b=["tags1","tags2","tags3","tags4","tags5"],c=$("#"+a+" b").get();var d=parseInt($("#"+a+" b").last().text());var e=Math.ceil(d/b.length);for(var f=0;f<c.length;f++){var g=parseInt(c[f].innerHTML);for(var h=0;h<b.length;h++){if(g>h*e&&g<=(h+1)*e){c[f].parentNode.className=b[h];break}}}$("#"+a).html($("#"+a+" li").get().sort(function(a,b){var c=$(a).find("span").text().toLowerCase();var d=$(b).find("span").text().toLowerCase();return c.localeCompare(d)}))}});if(!Cookie){var Cookie={readCookie:function(a){var b=a+"=";var c=document.cookie.split(";");for(var d=0;d<c.length;d++){var e=c[d];while(e.charAt(0)==" ")e=e.substring(1,e.length);if(e.indexOf(b)==0)return e.substring(b.length,e.length)}return""},eraseCookie:function(a){this.createCookie(a,"",-1)},createCookie:function(a,b,c){var d="";if(c){var e=new Date;e.setTime(e.getTime()+c*24*60*60*1e3);d="; expires="+e.toGMTString()}document.cookie=a+"="+b+d+"; path=/"}}}var goTop=function(a){a=a||.1;var b=$(window).scrollTop();var c=1+a;window.scrollTo(0,Math.floor(b/c));if(b>0){var d="goTop("+a+")";window.setTimeout(d,16)}};var collapseArchive=function(a,b){var c=true;if(a.className==="collapse-ico"){a.className="expand-ico";c=false}else{a.className="collapse-ico"}$("#archiveSide li").each(function(){var a=$(this);if(a.data("year")===b){if(c){$(this).show()}else{$(this).hide()}}})};var getArticle=function(a,b){var c=$("#abstract"+b),d=$("#content"+b);if(d.html()===""){$.ajax({url:"/get-article-content?id="+b,type:"GET",dataType:"html",beforeSend:function(){c.css("background","url(/skins/neoease/images/ajax-loader.gif) no-repeat scroll center center transparent")},success:function(b,e){a.className="collapse-ico";d.html(b);c.hide().css("background","none");d.fadeIn("slow")}})}else{if(a.className==="expand-ico"){c.hide();d.fadeIn();a.className="collapse-ico"}else{d.hide();c.fadeIn();a.className="expand-ico"}}return false};var goTranslate=function(){window.open("http://translate.google.com/translate?sl=auto&tl=auto&u="+location.href)};(function(){$(window).scroll(function(){var a=$(window).scrollTop();if(a>182){var b=$(window).height();var c=a+b-21;if($("body").height()-58<=a+b){c=$(".footer").offset().top-21}$("#goTop").fadeIn("slow").css("top",c)}else{$("#goTop").hide()}});var a=(new Date).getFullYear(),b=a;$("#archiveSide li").each(function(c){var d=$(this);if(d.data("year")!==a){$(this).hide()}if(b!==d.data("year")){b=d.data("year");d.before("<li class='archive-year'><div onclick='collapseArchive(this, "+b+")' class='expand-ico'>"+b+" å¹´</div></li>")}});$(".recent-comments .expand-ico").click(function(){if(this.className==="expand-ico"){$(this).parent().next().css({height:"auto","white-space":"normal"});this.className="collapse-ico"}else{$(this).parent().next().animate({height:"18px"},function(){$(this).css("white-space","nowrap")});this.className="expand-ico"}});$(".nav ul a").each(function(){var a=$(this);if(a.attr("href")===location.pathname){a.parent().addClass("current")}else if(/\/[0-9]+$/.test(location.pathname)){$(".nav ul li")[0].className="current"}})})()